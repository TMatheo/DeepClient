using UnityEngine;
using VRC.Core;
using VRC.SDKBase;
using VRC.UI.Elements.Controls;

namespace DeepCore.Client.Module.Exploits
{
    internal class PortalEploits
    {
        public static void DestroyPortals()
        {
            foreach (PortalInternal portalInternal in GameObject.FindObjectsOfType<PortalInternal>())
            {
                bool flag = portalInternal.field_Private_Int32_0 != -1;
                if (flag)
                {
                    GameObject.DestroyImmediate(portalInternal.gameObject);
                }
            }
        }
        public static void DestroyPortalsV2(bool log)
        {
            PortalInternal[] array = Resources.FindObjectsOfTypeAll<PortalInternal>();
            int num = 0;
            for (int i = 0; i < array.Length; i++)
            {
                bool flag = !(array[i] == null);
                if (flag)
                {
                    TextMeshProUGUIEx componentInChildren = array[i].GetComponentInChildren<TextMeshProUGUIEx>();
                    bool flag2 = (componentInChildren.text.Contains("public") || componentInChildren.text.Contains("invite") || componentInChildren.text.Contains("friends")) && !componentInChildren.text.Contains(APIUser.CurrentUser.displayName);
                    if (flag2)
                    {
                        Networking.Destroy(array[i].gameObject);
                        num++;
                    }
                }
            }
            if (log)
            {
                bool flag3 = num == 1;
                if (flag3)
                {
                    DeepConsole.Log("Portals", string.Format("Deleted {0} portal", num));
                }
                else
                {
                    bool flag4 = num > 1;
                    if (flag4)
                    {
                        DeepConsole.Log("Portals", string.Format("Deleted {0} portal", num));
                    }
                }
            }
        }
    }
}