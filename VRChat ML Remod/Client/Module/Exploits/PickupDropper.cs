using System.Collections;
using System.Collections.Generic;
using MelonLoader;
using UnityEngine;
using VRC.SDKBase;

namespace DeepCore.Client.Module.Exploits
{
    internal class PickupDropper
    {
        public static float dropDelay = 0.5f;
        public static bool C = false;
        public static List<VRC_Pickup> cachedPickups = new List<VRC_Pickup>();

        public static void State(bool s)
        {
            if (s) 
            {
                cachedPickups.Clear();
                cachedPickups.AddRange(UnityEngine.Object.FindObjectsOfType<VRC_Pickup>());
                MelonCoroutines.Start(Dropper());
                C = s;
            }
            else
            {
                cachedPickups.Clear();
                cachedPickups.AddRange(UnityEngine.Object.FindObjectsOfType<VRC_Pickup>());
                MelonCoroutines.Stop(Dropper());
                C = s;
            }
        }
        public static IEnumerator Dropper()
        {
            while (true)
            {
                if (!C) yield break;
                Drop();
                yield return new WaitForSecondsRealtime(dropDelay);
            }
        }
        public static void Drop()
        {
            VRCPlayerApi localPlayer = Networking.LocalPlayer;
            if (localPlayer == null)
                return;

            foreach (var pickup in cachedPickups)
            {
                if (pickup == null)
                    continue;
                Networking.SetOwner(localPlayer, pickup.gameObject);
                pickup.Drop();
            }
        }
    }
}
