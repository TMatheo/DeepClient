using System.Collections;
using System.Collections.Generic;
using DeepClient.Client.Misc.DeepClient.Client.Misc;
using UnityEngine;
using VRC.SDKBase;

namespace DeepClient.Client.Module.Exploits
{
    internal class PickupDropper
    {
        public static bool IsEnabled = false;
        public static bool C = false;
        public static float dropDelay = 0.5f;
        public static List<VRC_Pickup> cachedPickups = new List<VRC_Pickup>();

        public static void State(bool s)
        {
            if (s)
            {
                cachedPickups.Clear();
                cachedPickups.AddRange(UnityEngine.Object.FindObjectsOfType<VRC_Pickup>());
                Dropper().Start();
                C = s;
            }
            else
            {
                cachedPickups.Clear();
                cachedPickups.AddRange(UnityEngine.Object.FindObjectsOfType<VRC_Pickup>());
                C = s;
            }
        }
        public static IEnumerator Dropper()
        {
            while (C)
            {
                if (!C) yield break;
                Drop();
                yield return new WaitForSecondsRealtime(dropDelay);
            }
            yield break;
        }
        public static void Drop()
        {
            VRCPlayerApi localPlayer = Networking.LocalPlayer;
            if (localPlayer == null)
                return;

            foreach (var pickup in cachedPickups)
            {
                if (pickup == null)
                    continue;
                Networking.SetOwner(localPlayer, pickup.gameObject);
                pickup.Drop();
            }
        }
    }
}